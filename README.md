# `srf-n-trf`
Script to take `srf` and `trf` output and produce a BED file with only regions corresponding to monomers of a given periodicity.

## Getting Started
1. Run `srf` and `trf` on a T2T genome assembly using https://github.com/logsdon-lab/Snakemake-srf.git. Use these outputs.
```
results/{sample}/{contig}
├── trf_monomers.tsv (*)
├── srf.bed
├── srf.fa
└── srf.paf (*)
```

2. Clone repo. Requires `rust`.
```bash
git clone https://github.com/koisland/srf-n-trf.git
```

3. Compile.
```bash
cargo build --release
```

## Usage

### `monomers`
```bash
target/release/srf-n-trf monomers \
-p results/{sample}/{contig}/srf.paf \
-m results/{sample}/{contig}/monomers.tsv \
-s 170 340 42 \
-d 0.02
```
This will:
* Search for `trf` monomers in PAF cigar with a periodicity of `170`, `340`, and `42` with a `2%` length difference.
    * These correspond to α-satellite and HSAT-1A repeats.
* Generate a BED9 file in target coordinate space and the overlapping monomers delimited by commas in the `name` column.

```
chr3_mat_hsa4	76301546	76301589	TATGAAAAGAAAGGTTAAACTCTGTGAGTTGAACGCACACATCACAAAGTAGTTTCTGAGAATGATTCTCTCTAGTTTTTATACGAAGATATTTCCTTTTCTACCATTGGCCTCAAAGCACTTGAAATCTCCACCTGCAAATTCCACAAAAAGAGTGTTTCAAATCTGCTCTGTCTAAAGGAAGCTTCAACTCTGTGAGTTGAATACACACAACACAAAGAAGTTACTGAGAATTCTTCTGTCTAGCATTATATGAAGAAATCCCGTTTCCAACGAAGGCCTCAAAGAGGTCCAAATATCCACTTGCAGACTTAACAAACAGAGTGTTTCCAAACTGCTC,AAAAGAAAGGTTAAACTCTGTGAGTTGAACACACACAACACAAAGAAGTTACTGAGAATGATTCTGTCTAGCATTATACGAAGAAATCCCGTTTCCAACGAAGGCCTCAAAGAGGTCCAAATATCCACTTGCAACTTAACAAACAGAGTGTTTCCAAACTGCTCTGTC,AAAGGAAGGTTCAACTCTGTGAGTTGAACACACACATCACAAAGAAGTTACTGAGAATGATTCTCTCTAGTTTTATACGAAGATATTTCCTTTTCAAAAATGGCCTCAAAGCGCTTCAAATCTCCACTTGCAAATTCCACAAAAAGAGTGTTTCAAATCTGCTCTGTCT	0	-	76301546	76301589	0,0,0
```
> The example in `test/chr3` is mGorGor1 chr3_mat_hsa4 from the [T2T Primates project](https://github.com/marbl/Primates?tab=readme-ov-file).

### `motifs`
```bash
target/release/srf-n-trf motifs \
-f results/{sample}/{contig}/srf.fa \
-m results/{sample}/{contig}/monomers.tsv \
-s 170 340 \
-d 0.02
```
This will:
* Search for `srf` motifs with monomers with a periodicity of `170` and `340` within a `2%` length difference.
    * These correspond to α-satellite and HSAT-1A repeats.

```
>prefix#circ2-1706
TTGAATGCACTTATCACAAAGCAGTTTCTGAGAATGCTTCCGTCCAGCTTTTGTGCAATGATATTTCCTTTTGCAGCATAGGCCTCAAAATGTTCCAAATATCCACTTGCAGATTCTACAAAAAGAGTGTTTCAAAACTGCTCTATGGAAAGGCAGGTGGATCTCTGTGAGTTGAGTGCACAAAGCACAGGGAACTTTCTGAGAATGCTTTTGTCTAGTTTCTAGGTGAAGATATTTCCTTGTCCAGCATAGGCCTCAAAGCACTCCATCCATCCACTTGAAGATTCTGCTAAAAGAGTGTTTCAAAACTTCTCTATCGAAAGAAAGGTTCAACTCTGTGAGTTGAATGCAGACGTTACAAAGAAGTTTCTGAGAATGCTTCTGTCCAGTTTTTATGTGAAGGTATTTCCTTTTCCAGCATAGGCCTCAAAGCGCTCCATATATCCACTTGCAGATTCTGCAAAAAGAGCGTTTCCAAACTGCTCTCTCAAAAGGAAGGTTCAACTCTGTGAGTTGAATGCGTGCATCGCGAAGAAGTTTCAGAGAATGCTTCTGTCTAGTTTTTAGGTGAAGATATTTCATTTCCCAGCATAGGCCTCAAGGCGCTAGAAATATCCACTTGCAGATTCTACAAAAAGAGTGTTTCATAACTGCGCTTTGAAAAAGAAGGTTCAAGTCTGTGAGTTGAATGCACTGAGCAGAAAGAAGTTTGTGAGAGCGCTTCTATCTAGTTTTCATCTGCATGTAGTTCCTTTTCCACTAGATGCCGCAATCGCACCAAATATCCACATGCAGTTTCCACAAAAAGAGTGTTGCAGAACTGCTCCATGAAAAGGAATGTTCAACTCTGTGAGTTCAATCCCCACATGACATAGCAGTTTCTGAAATGCTTCTGTCTAGTTTGTATATGAAGATATTTCCTTTTCCAGCATAAGCCTCAAAGAGCTCCAAATATCCACTTGCTGAGTCTACAAAAACAGTGTTTCAAAACTGGTCTCTCAAAAGGAAGGTTCAACTCTGTGAGTTGAATGCACTTATCACAAAGCAGTTTCTGAGAATGCTTCCGTCCAGCTTTTATGCAACGATATTTCCTTTGGCAGCATAGGCCTCAAAGCGCTCCAAATATCCCCTTGCAGATTCTACAAAAAGGGTGTTTCCAAACTGCTCTCTCAAAAGGAAGGTTCAACTCTGTGAGTTGAATGCGTGCATCGCGAAGAAGTTTCTTAGAATGCTTCTGTCTAGTTCTTAGGTGAAGATATTTCATTTCCCAGCATAGGCCTCAAGGCGCTCCAAATATCCACTTGCAGATTCTACAAAAAGAGTGTTTCAAAACTGCGCTTTGAAAAGGAAGGTTCAAGTCTGTCAGTTGAATGCACTCAGCAGAAAGAAGTTTCTGAGAGCGCTTCTATCCAGTTTTCATCTGCATGTAGTTCCTTTTCCACTAGATGCCGCAATCGCACCAAATATCCAATTGCAGTTTCTACAAAAAGAGTGTTGCAGAACTGCTCCATGAAAAGGAATGTTCAACTCTGTGAGTTCAATCCCCACATTACATAGCAGTTTCTGAAATGCTTCTGTCTTGTTTGTATATGAAGATATTTCCTTTTACAGCATAAGCCTCAAAGAGCTCCAAATATCCAATTGCTGACTCTACAAAAACTGTGTTTCAAAACTGGTCTCTCAAAAGGAAGGTTCAACTCTGTGAG
```

### `regions`
```bash
target/release/srf-n-trf regions \
-b extract.bed \
-d 100000 \
-m 30000 \
-s 170 340 \
--diff 0.02
```
This will:
* Merge the extract bed output by 100 kbp.
* Retain only regions that contain monomers of periodicity within `2%` difference in length of `170` and `340` bp and are at least 30 kbp.

```
chr3_mat_hsa4   76301546        86011178        CAAGCGCTTTGGGGCCAATGGTAGAAAAGGAAATATCTTCGTATAAAAACTAGAGAGAATCATTCTCAGCAACCACTTTGTGATGTGTGCGTTCCACTCACAGAGTTTAACCTTTCTTTTCATAGAGCAGTTTGGAAACACTCTGTTTGTAAAGTCTGCAAGTGGATATTTGGACCTCTTTGAGGATTTCGTTGGAAACGGGATTTCTGCATATAACGCTAGACAGAAGAATTCTCAGTAACTTCTTTGGGCTGCGTGTGTTCAACTCACAGAGTTGAACCTTCCTTTAGACAGAGCAGATTTGAAACCCTCTTTTTGTGGAATTTGCAAGTGGAGATTT,GTTTGTAAAGTCTGCATGTGGATATATGGACCTCTTTGAGGATTTCGTTGGAAACGGGATTTCTTCATCTAATGCTAAACAGAAGAATTCTCAGTAACTTCTTTGGGTTGCGTGTGTTCAACTCACAGAGATGAACATTACTTGAGACAGAGCAGATTTGAAACCCTCTTTTCCTGGAATTTGCAACTGGACATTTCAAGCGCTTTGGGGCCAACGGAAGAAAAGGAAATATCTTCGTATAAAAACTAGAGTGAATCAGTCTGAGAAACCACTTTCTGATGTGGGCATTCCACTCACAGAGTTTAACCTTTTTTTCATAGAACAGTTTGGAAACACTGT,TATGAAAAGAAAGGTTAAACTCTGTGAGTTGAACGCACACATCACAAAGTAGTTTCTGAGAATGATTCTCTCTAGTTTTTATACGAAGATATTTCCTTTTCTACCATTGGCCTCAAAGCACTTGAAATCTCCACCTGCAAATTCCACAAAAAGAGTGTTTCAAATCTGCTCTGTCTAAAGGAAGCTTCAACTCTGTGAGTTGAATACACACAACACAAAGAAGTTACTGAGAATTCTTCTGTCTAGCATTATATGAAGAAATCCCGTTTCCAACGAAGGCCTCAAAGAGGTCCAAATATCCACTTGCAGACTTAACAAACAGAGTGTTTCCAAACTGCTC,AAATCTGCTCTGTCTAAAGGAAAGTTCATCTCTGTGAGTTGAACACACACAACCCAAAGAAGTTACTGAGAATTCTTCTGTCTAGCATTAGATGAAGAAATCCCATTTCCAACGAAATCCTCAAAGAGGTCCAAATATCCACATGCAGACTTTACAAACACAGTGTTTCCAAACTGTTCTATGAAAAGAAAGGTTAAACTCTGTGAGTGGAACGCACACATCACAAAGTAGTTTCTCAGAATGATTCACTCTAGTTTTTATACGAAGATATTTCCTTTTCTACCGTTGGCCCCAAACCGCTTGAAATGTCCACTTGCAAATTCCACAAAAAGAGGGTTTC,ACGGTAGAAAAGGAAATATCTTCGCTTAAAAACTAGAGAGAATCAGTCTGAGAAACCACTTTGTGAGGTGTCCATTCCACTCACAGAGTTTAACCTTTCTATTCATAGAACAGTTTGGAAACACTCTGTTTGTAAAGTCTGCACGTGGATATATGGACCACTTTGAGGATTTCGTTGGAAACGGGATTTCTTCAACAAATGCTAAAAAGAAGAATTCTCAGTAACTTATTTGGGTTGTGTGAGATCAACTCACAGAGATCAACTTCACTTTAGACAGAGCAGATATGAAACCCTCTTTTTGTGGAATGTGCAAGTGGACATTTCAAGCGCTTTGGCGCCA,TGAAACCCTCTTTTTGTGGAATTTGCAAGTGGACATTTCAAGCGCTTTGGGGCCAACGGTAGAAAAGGAAATATCTTCGTATAAAAACTAGAGTGAATCATTCTGAGAAACCACTTTCTGATGTGTGCGTTCCACTCACAGAGTTTAACCTTTCTTTTCATAGAACAGTTTGGAAACACTGTGTTTGTAAAGTCTGCATGTGGATATTTGGACCTCTTTGAGGATTTCGTTGGAAACGGGATTTCTTCATCTAATGCTAGACAGAAGAATTCTCAGTAACTTATTTGGGTTGCGTGTGTTCAACTCACAGAGATGAACATTCCTTTAGACAGAGCAGATT,AAAAGAAAGGTTAAACTCTGTGAGTTGAACACACACAACACAAAGAAGTTACTGAGAATGATTCTGTCTAGCATTATACGAAGAAATCCCGTTTCCAACGAAGGCCTCAAAGAGGTCCAAATATCCACTTGCAACTTAACAAACAGAGTGTTTCCAAACTGCTCTGTC,AAAGGAAGGTTCAACTCTGTGAGTTGAACACACACATCACAAAGAAGTTACTGAGAATGATTCTCTCTAGTTTTATACGAAGATATTTCCTTTTCAAAAATGGCCTCAAAGCGCTTCAAATCTCCACTTGCAAATTCCACAAAAAGAGTGTTTCAAATCTGCTCTGTCT  0       .       76301546        86011178        0,0,0
```

## Examples
### `monomers`
```bash
target/release/srf-n-trf monomers -p <(zcat test/chr3_mGorGor1/srf.paf.gz) -m <(zcat test/chr3_mGorGor1/monomers.tsv.gz)
target/release/srf-n-trf monomers -p <(zcat test/chrX_mPonAbe1/srf.paf.gz) -m <(zcat test/chrX_mPonAbe1/monomers.tsv.gz)
```

### `motifs`
```bash
target/release/srf-n-trf motifs -f <(zcat test/chrX_mPonAbe1/srf.fa.gz) -m <(zcat test/chrX_mPonAbe1/monomers.tsv.gz)
```

### `regions`
```bash
target/release/srf-n-trf regions -b <(zcat test/chr3_mGorGor1/monomers.bed.gz)
target/release/srf-n-trf regions -b <(zcat test/chrX_mPonAbe1/monomers.bed.gz)
```

## TODO
* [ ] Unit and integration tests.
* [ ] Support compressed output.
* [ ] Better documentation.
* [ ] CI and release workflow.
